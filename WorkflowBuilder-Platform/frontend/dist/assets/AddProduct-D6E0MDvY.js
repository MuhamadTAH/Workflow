import{u as se,h as ae,r as p,t as N,j as e,N as ie,s as T,S as te,i as w,d as ne,k as oe,l as $,m as re,n as le,o as ce,p as O,q as de}from"./index-BXAzR72f.js";function pe(){const C=se(),E=ae(),[j,R]=p.useState(null),[L,z]=p.useState(!0),[A,D]=p.useState(!1),[F,l]=p.useState(""),[V,S]=p.useState(""),u=E.state?.editMode,n=E.state?.productData,[a,d]=p.useState({title:"",description:"",price:"",category:"",brand:"",sku:"",tags:[],images:[],videos:[],variants:[],specifications:{},seoTitle:"",seoDescription:"",seoKeywords:"",isActive:!0,isFeatured:!1,stock:"",weight:"",dimensions:{length:"",width:"",height:""}}),[b,U]=p.useState(""),[h,y]=p.useState({name:"",value:"",price:""}),[x,P]=p.useState({key:"",value:""}),[v,k]=p.useState("basic"),B=["Electronics","Clothing","Home & Garden","Books","Sports","Beauty","Toys","Food","Health","Automotive","Other"];if(!N.isLoggedIn())return e.jsx(ie,{to:"/login"});p.useEffect(()=>{I(),u&&n&&d({title:n.title||"",description:n.description||"",price:n.price||"",category:n.category||"",brand:n.brand||"",sku:n.sku||"",tags:n.tags||[],images:n.images||[],videos:n.videos||[],variants:n.variants||[],specifications:n.specifications||{},seoTitle:n.seoTitle||"",seoDescription:n.seoDescription||"",seoKeywords:n.seoKeywords||"",isActive:n.isActive!==void 0?n.isActive:!0,isFeatured:n.isFeatured||!1,stock:n.stock||"",weight:n.weight||"",dimensions:n.dimensions||{length:"",width:"",height:""}})},[u,n]);const I=async()=>{try{const s=await T.getMyShop();R(s.data.shop),s.data.shop||l("Please create a shop first before adding products.")}catch(s){console.error("Error loading shop:",s),l("Unable to load shop data")}finally{z(!1)}},c=s=>{const{name:t,value:i,type:r,checked:m}=s.target;if(t.includes(".")){const[o,f]=t.split(".");d(g=>({...g,[o]:{...g[o],[f]:i}}))}else d(o=>({...o,[t]:r==="checkbox"?m:i}))},M=()=>{b.trim()&&!a.tags.includes(b.trim())&&(d(s=>({...s,tags:[...s.tags,b.trim()]})),U(""))},q=s=>{d(t=>({...t,tags:t.tags.filter(i=>i!==s)}))},K=()=>{h.name&&h.value&&(d(s=>({...s,variants:[...s.variants,{...h,id:Date.now()}]})),y({name:"",value:"",price:""}))},G=s=>{d(t=>({...t,variants:t.variants.filter(i=>i.id!==s)}))},H=()=>{x.key&&x.value&&(d(s=>({...s,specifications:{...s.specifications,[x.key]:x.value}})),P({key:"",value:""}))},W=s=>{d(t=>{const i={...t.specifications};return delete i[s],{...t,specifications:i}})},_=async s=>{const t=Array.from(s.target.files);for(const i of t)try{const r=new FormData;r.append("image",i);const m=await fetch("http://localhost:3001/api/uploads/product-image",{method:"POST",headers:{Authorization:`Bearer ${N.getToken()}`},body:r});if(m.ok){const o=await m.json(),f={id:Date.now()+Math.random(),url:o.imageUrl,name:o.originalName,filename:o.filename};d(g=>({...g,images:[...g.images,f]}))}else console.error("Upload failed:",await m.text()),l("Failed to upload image. Please try again.")}catch(r){console.error("Upload error:",r),l("Failed to upload image. Please try again.")}},J=async s=>{const t=Array.from(s.target.files);for(const i of t){if(i.size>50*1024*1024){l(`Video file "${i.name}" is too large. Maximum size is 50MB.`);continue}if(!i.type.startsWith("video/")){l(`File "${i.name}" is not a video file.`);continue}try{const r=new FormData;r.append("video",i),console.log("Uploading video:",i.name,"Size:",i.size,"Type:",i.type);const m=await fetch("/api/uploads/product-video",{method:"POST",headers:{Authorization:`Bearer ${N.getToken()}`},body:r});if(m.ok){const o=await m.json(),f={id:Date.now()+Math.random(),url:o.videoUrl,name:o.originalName,filename:o.filename};d(g=>({...g,videos:[...g.videos,f]})),console.log("Video uploaded successfully:",o)}else{const o=await m.text();console.error("Upload failed with status:",m.status,"Error:",o),m.status===404?l("Video upload endpoint not available. Please restart the backend server."):l(`Failed to upload video: ${o}`)}}catch(r){if(console.error("Upload error:",r),r.message.includes("ERR_CONNECTION_RESET")||r.message.includes("Failed to fetch")){console.log("Using temporary blob URL as fallback");const m={id:Date.now()+Math.random(),url:URL.createObjectURL(i),name:i.name,filename:null,isTemporary:!0};d(o=>({...o,videos:[...o.videos,m]})),l("Video stored temporarily. Please restart backend server for permanent storage.")}else l(`Failed to upload video: ${r.message}`)}}},Q=async s=>{const t=a.images.find(i=>i.id===s);if(d(i=>({...i,images:i.images.filter(r=>r.id!==s)})),t?.filename)try{await fetch(`http://localhost:3001/api/uploads/product-image/${t.filename}`,{method:"DELETE",headers:{Authorization:`Bearer ${N.getToken()}`}})}catch(i){console.error("Error deleting image from server:",i)}},Y=async s=>{const t=a.videos.find(i=>i.id===s);if(d(i=>({...i,videos:i.videos.filter(r=>r.id!==s)})),t?.filename)try{await fetch(`http://localhost:3001/api/uploads/product-video/${t.filename}`,{method:"DELETE",headers:{Authorization:`Bearer ${N.getToken()}`}})}catch(i){console.error("Error deleting video from server:",i)}},X=()=>a.title.trim()?!a.price||a.price<=0?(l("Valid price is required"),!1):a.description.trim()?!0:(l("Product description is required"),!1):(l("Product title is required"),!1),Z=async()=>{if(l(""),!!X()){if(!j){l("Please create a shop first before adding products.");return}D(!0);try{const s={title:a.title,description:a.description,price:parseFloat(a.price),imageUrl:a.images[0]?.url||null,videos:a.videos||[],isVisible:a.isActive};let t;u&&n?(t=await T.updateProduct(n.id,s),S("Product updated successfully!")):(t=await T.addProduct(j.shopName,s),S("Product added successfully!")),setTimeout(()=>{C("/shop/manage-products")},2e3)}catch(s){console.error("Error saving product:",s);const t=s.response?.data?.message||`Failed to ${u?"update":"save"} product`;l(t)}finally{D(!1)}}},ee=()=>{S("Product preview feature coming soon! (Development Mode)")};return L?e.jsx("div",{className:"loading",children:e.jsx("div",{children:"Loading..."})}):j?e.jsxs(te,{title:u?"Edit Product":"Add New Product",subtitle:j?`${u?"Edit product in":"Add a product to"} ${j.displayName}`:`${u?"Edit product in your shop":"Add a new product to your shop"}`,children:[F&&e.jsx("div",{className:"error-message",children:F}),V&&e.jsx("div",{className:"success-message",children:V}),e.jsx("div",{className:"add-product-page",children:e.jsxs("div",{className:"add-product-container",children:[e.jsx("div",{className:"add-product-header",children:e.jsxs("div",{className:"header-actions",children:[e.jsxs("button",{className:"btn btn-secondary",onClick:()=>C("/shop"),children:[e.jsx(w,{})," Cancel"]}),e.jsxs("button",{className:"btn btn-outline",onClick:ee,children:[e.jsx(ne,{})," Preview"]}),e.jsxs("button",{className:"btn btn-primary",onClick:Z,disabled:A,children:[e.jsx(oe,{})," ",A?u?"Updating...":"Saving...":u?"Update Product":"Save Product"]})]})}),e.jsxs("div",{className:"add-product-content",children:[e.jsxs("div",{className:"tab-navigation",children:[e.jsxs("button",{className:`tab-btn ${v==="basic"?"active":""}`,onClick:()=>k("basic"),children:[e.jsx($,{})," Basic Info"]}),e.jsxs("button",{className:`tab-btn ${v==="media"?"active":""}`,onClick:()=>k("media"),children:[e.jsx(re,{})," Media"]}),e.jsxs("button",{className:`tab-btn ${v==="variants"?"active":""}`,onClick:()=>k("variants"),children:[e.jsx(le,{})," Variants"]}),e.jsxs("button",{className:`tab-btn ${v==="seo"?"active":""}`,onClick:()=>k("seo"),children:[e.jsx($,{})," SEO & Details"]})]}),e.jsxs("div",{className:"tab-content",children:[v==="basic"&&e.jsx("div",{className:"tab-panel",children:e.jsxs("div",{className:"form-section",children:[e.jsx("h3",{children:"Product Information"}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Product Title *"}),e.jsx("input",{type:"text",name:"title",value:a.title,onChange:c,placeholder:"Enter product title",className:"form-input",required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Price * ($)"}),e.jsx("input",{type:"number",name:"price",value:a.price,onChange:c,placeholder:"0.00",step:"0.01",min:"0",className:"form-input",required:!0})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Description *"}),e.jsx("textarea",{name:"description",value:a.description,onChange:c,placeholder:"Describe your product...",className:"form-textarea",rows:"4",required:!0})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Category"}),e.jsxs("select",{name:"category",value:a.category,onChange:c,className:"form-select",children:[e.jsx("option",{value:"",children:"Select category"}),B.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Brand"}),e.jsx("input",{type:"text",name:"brand",value:a.brand,onChange:c,placeholder:"Brand name",className:"form-input"})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"SKU"}),e.jsx("input",{type:"text",name:"sku",value:a.sku,onChange:c,placeholder:"Product SKU",className:"form-input"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Stock Quantity"}),e.jsx("input",{type:"number",name:"stock",value:a.stock,onChange:c,placeholder:"Available quantity",min:"0",className:"form-input"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Tags"}),e.jsxs("div",{className:"tags-input",children:[e.jsx("input",{type:"text",value:b,onChange:s=>U(s.target.value),placeholder:"Add a tag",className:"form-input",onKeyPress:s=>s.key==="Enter"&&(s.preventDefault(),M())}),e.jsx("button",{type:"button",onClick:M,className:"btn btn-secondary",children:"Add"})]}),e.jsx("div",{className:"tags-display",children:a.tags.map((s,t)=>e.jsxs("span",{className:"tag",children:[s,e.jsx("button",{onClick:()=>q(s),className:"tag-remove",children:e.jsx(w,{})})]},t))})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Weight (kg)"}),e.jsx("input",{type:"number",name:"weight",value:a.weight,onChange:c,placeholder:"0.0",step:"0.1",min:"0",className:"form-input"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Dimensions (cm)"}),e.jsxs("div",{className:"dimensions-input",children:[e.jsx("input",{type:"number",name:"dimensions.length",value:a.dimensions.length,onChange:c,placeholder:"L",className:"form-input dimension-input"}),e.jsx("span",{children:"×"}),e.jsx("input",{type:"number",name:"dimensions.width",value:a.dimensions.width,onChange:c,placeholder:"W",className:"form-input dimension-input"}),e.jsx("span",{children:"×"}),e.jsx("input",{type:"number",name:"dimensions.height",value:a.dimensions.height,onChange:c,placeholder:"H",className:"form-input dimension-input"})]})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsx("div",{className:"form-group",children:e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",name:"isActive",checked:a.isActive,onChange:c}),"Product is active"]})}),e.jsx("div",{className:"form-group",children:e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",name:"isFeatured",checked:a.isFeatured,onChange:c}),"Featured product"]})})]})]})}),v==="media"&&e.jsxs("div",{className:"tab-panel",children:[e.jsxs("div",{className:"form-section",children:[e.jsx("h3",{children:"Product Images"}),e.jsxs("div",{className:"media-upload",children:[e.jsx("input",{type:"file",id:"image-upload",multiple:!0,accept:"image/*",onChange:_,style:{display:"none"}}),e.jsxs("label",{htmlFor:"image-upload",className:"upload-btn",children:[e.jsx(ce,{})," Upload Images"]}),e.jsx("p",{className:"upload-hint",children:"Supported formats: JPG, PNG, GIF. Max 5MB each."})]}),e.jsx("div",{className:"media-grid",children:a.images.map(s=>e.jsxs("div",{className:"media-item",children:[e.jsx("img",{src:s.url,alt:s.name,className:"media-preview"}),e.jsx("div",{className:"media-overlay",children:e.jsx("button",{onClick:()=>Q(s.id),className:"media-remove",children:e.jsx(O,{})})}),e.jsx("p",{className:"media-name",children:s.name})]},s.id))})]}),e.jsxs("div",{className:"form-section",children:[e.jsx("h3",{children:"Product Videos"}),e.jsxs("div",{className:"media-upload",children:[e.jsx("input",{type:"file",id:"video-upload",multiple:!0,accept:"video/*",onChange:J,style:{display:"none"}}),e.jsxs("label",{htmlFor:"video-upload",className:"upload-btn",children:[e.jsx(de,{})," Upload Videos"]}),e.jsx("p",{className:"upload-hint",children:"Supported formats: MP4, MOV, AVI. Max 50MB each."})]}),e.jsx("div",{className:"media-grid",children:a.videos.map(s=>e.jsxs("div",{className:"media-item",children:[e.jsx("video",{src:s.url,className:"media-preview",controls:!0}),e.jsx("div",{className:"media-overlay",children:e.jsx("button",{onClick:()=>Y(s.id),className:"media-remove",children:e.jsx(O,{})})}),e.jsx("p",{className:"media-name",children:s.name})]},s.id))})]})]}),v==="variants"&&e.jsxs("div",{className:"tab-panel",children:[e.jsxs("div",{className:"form-section",children:[e.jsx("h3",{children:"Product Variants"}),e.jsx("p",{className:"section-description",children:"Add variants like size, color, material, etc."}),e.jsxs("div",{className:"variant-input",children:[e.jsx("input",{type:"text",value:h.name,onChange:s=>y({...h,name:s.target.value}),placeholder:"Variant name (e.g., Size, Color)",className:"form-input"}),e.jsx("input",{type:"text",value:h.value,onChange:s=>y({...h,value:s.target.value}),placeholder:"Value (e.g., Large, Red)",className:"form-input"}),e.jsx("input",{type:"number",value:h.price,onChange:s=>y({...h,price:s.target.value}),placeholder:"Price adjustment",step:"0.01",className:"form-input"}),e.jsx("button",{type:"button",onClick:K,className:"btn btn-secondary",children:"Add Variant"})]}),e.jsx("div",{className:"variants-list",children:a.variants.map(s=>e.jsxs("div",{className:"variant-item",children:[e.jsx("span",{className:"variant-name",children:s.name}),e.jsx("span",{className:"variant-value",children:s.value}),s.price&&e.jsxs("span",{className:"variant-price",children:["+$",s.price]}),e.jsx("button",{onClick:()=>G(s.id),className:"variant-remove",children:e.jsx(w,{})})]},s.id))})]}),e.jsxs("div",{className:"form-section",children:[e.jsx("h3",{children:"Product Specifications"}),e.jsx("p",{className:"section-description",children:"Add technical specifications and product details."}),e.jsxs("div",{className:"spec-input",children:[e.jsx("input",{type:"text",value:x.key,onChange:s=>P({...x,key:s.target.value}),placeholder:"Specification name",className:"form-input"}),e.jsx("input",{type:"text",value:x.value,onChange:s=>P({...x,value:s.target.value}),placeholder:"Value",className:"form-input"}),e.jsx("button",{type:"button",onClick:H,className:"btn btn-secondary",children:"Add Spec"})]}),e.jsx("div",{className:"specs-list",children:Object.entries(a.specifications).map(([s,t])=>e.jsxs("div",{className:"spec-item",children:[e.jsx("span",{className:"spec-key",children:s}),e.jsx("span",{className:"spec-value",children:t}),e.jsx("button",{onClick:()=>W(s),className:"spec-remove",children:e.jsx(w,{})})]},s))})]})]}),v==="seo"&&e.jsx("div",{className:"tab-panel",children:e.jsxs("div",{className:"form-section",children:[e.jsx("h3",{children:"SEO Optimization"}),e.jsx("p",{className:"section-description",children:"Optimize your product for search engines."}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"SEO Title"}),e.jsx("input",{type:"text",name:"seoTitle",value:a.seoTitle,onChange:c,placeholder:"SEO title for search engines",className:"form-input",maxLength:"60"}),e.jsxs("small",{children:[a.seoTitle.length,"/60 characters"]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"SEO Description"}),e.jsx("textarea",{name:"seoDescription",value:a.seoDescription,onChange:c,placeholder:"Meta description for search results",className:"form-textarea",rows:"3",maxLength:"160"}),e.jsxs("small",{children:[a.seoDescription.length,"/160 characters"]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"SEO Keywords"}),e.jsx("input",{type:"text",name:"seoKeywords",value:a.seoKeywords,onChange:c,placeholder:"Comma-separated keywords",className:"form-input"})]})]})})]})]})]})})]}):e.jsxs("div",{className:"error-container",children:[e.jsx("h2",{children:"Shop Required"}),e.jsx("p",{children:"You need to create a shop first before adding products."}),e.jsx("button",{className:"btn btn-primary",onClick:()=>C("/shop"),children:"Go to Shop Dashboard"})]})}export{pe as default};
