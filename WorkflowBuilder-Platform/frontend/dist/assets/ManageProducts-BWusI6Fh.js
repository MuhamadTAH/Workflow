import{u as O,r as i,t as A,j as s,N as Y,s as n,S as g,v as h,w as R,m as H,d as U,x as B,c as G,p as q}from"./index-BXAzR72f.js";function K(){const x=O(),[a,c]=i.useState([]),[y,P]=i.useState(!0),[j,l]=i.useState(""),[v,w]=i.useState(null),[z,b]=i.useState(!1),[N,d]=i.useState(""),[u,p]=i.useState(null);if(!A.isLoggedIn())return s.jsx(Y,{to:"/login"});i.useEffect(()=>{S()},[]);const S=async()=>{try{const e=await n.getMyShop();if(w(e.data.shop),e.data.shop){const t=await n.getShopProducts(e.data.shop.shopName);c(t.data.products||[])}}catch(e){console.error("Error loading products:",e),l("Failed to load products")}finally{P(!1)}},D=e=>{x(`/shop/product/${e.id}`)},E=e=>{x("/shop/add-product",{state:{editMode:!0,productData:e}})},V=async e=>{try{const t=!e.isVisible;await n.updateProduct(e.id,{isVisible:t}),c(a.map(r=>r.id===e.id?{...r,isVisible:t}:r)),d(`Product "${e.title}" is now ${t?"visible":"hidden"} to customers`),setTimeout(()=>d(""),3e3)}catch(t){console.error("Error updating product visibility:",t),l("Failed to update product visibility")}},F=async e=>{if(window.confirm(`Are you sure you want to delete "${e.title}"? This action cannot be undone.`)){b(!0);try{await n.deleteProduct(e.id),c(a.filter(t=>t.id!==e.id)),d(`Product "${e.title}" deleted successfully!`),setTimeout(()=>d(""),3e3)}catch(t){console.error("Error deleting product:",t),l("Failed to delete product")}finally{b(!1)}}},M=(e,t)=>{p(t),e.dataTransfer.effectAllowed="move"},C=e=>{e.preventDefault(),e.dataTransfer.dropEffect="move"},k=(e,t)=>{if(e.preventDefault(),!u||u.id===t.id){p(null);return}const r=a.findIndex(o=>o.id===u.id),$=a.findIndex(o=>o.id===t.id),m=[...a],[I]=m.splice(r,1);m.splice($,0,I);const f=m.map((o,L)=>({...o,displayOrder:L+1}));c(f),p(null),T(f)},T=async e=>{try{await n.updateProductOrder(e.map(t=>({id:t.id,displayOrder:t.displayOrder}))),d("Product order updated successfully!"),setTimeout(()=>d(""),3e3)}catch(t){console.error("Error updating product order:",t),l("Failed to update product order")}};return y?s.jsx(g,{title:"Manage Products",subtitle:"View and manage all your products",children:s.jsx("div",{className:"loading",children:"Loading products..."})}):v?s.jsx(g,{title:"Manage Products",subtitle:`Managing products for ${v.displayName}`,children:s.jsxs("div",{className:"manage-products-page",children:[j&&s.jsx("div",{className:"error-message",children:j}),N&&s.jsx("div",{className:"success-message",children:N}),s.jsxs("div",{className:"products-header",children:[s.jsxs("h3",{children:["Your Products (",a.length,")"]}),s.jsxs("button",{className:"btn btn-primary",onClick:()=>window.location.href="/shop/add-product",children:[s.jsx(h,{})," Add New Product"]})]}),a.length===0?s.jsxs("div",{className:"no-products-message",children:[s.jsx(h,{className:"no-products-icon"}),s.jsx("h3",{children:"No Products Yet"}),s.jsx("p",{children:"Start by adding your first product to your shop!"}),s.jsx("button",{className:"btn btn-primary",onClick:()=>window.location.href="/shop/add-product",children:"Add Your First Product"})]}):s.jsx("div",{className:"products-grid",children:a.map(e=>s.jsxs("div",{className:`product-card ${u?.id===e.id?"dragging":""}`,draggable:!0,onDragStart:t=>M(t,e),onDragOver:C,onDrop:t=>k(t,e),children:[s.jsx("div",{className:"product-drag-handle",children:s.jsx(R,{})}),s.jsx("div",{className:"product-image",children:e.imageUrl?s.jsx("img",{src:e.imageUrl,alt:e.title}):s.jsx("div",{className:"product-image-placeholder",children:s.jsx(H,{})})}),s.jsxs("div",{className:"product-content",children:[s.jsxs("div",{className:"product-header",children:[s.jsx("h4",{className:"product-title",children:e.title}),s.jsx("div",{className:"product-visibility",children:e.isVisible!==!1?s.jsx("span",{className:"visibility-badge visible",children:"Visible"}):s.jsx("span",{className:"visibility-badge hidden",children:"Hidden"})})]}),s.jsxs("p",{className:"product-price",children:["$",e.price]}),e.description&&s.jsx("p",{className:"product-description",children:e.description}),e.videos&&e.videos.length>0&&s.jsx("div",{className:"product-videos-indicator",children:s.jsxs("span",{className:"videos-count",children:["ðŸŽ¥ ",e.videos.length," video",e.videos.length>1?"s":""]})}),s.jsx("div",{className:"product-meta",children:s.jsxs("span",{className:"product-date",children:["Created: ",new Date(e.createdAt).toLocaleDateString()]})}),s.jsxs("div",{className:"product-actions",children:[s.jsx("button",{className:"btn-icon",title:e.isVisible!==!1?"Hide from customers":"Show to customers",onClick:()=>V(e),children:e.isVisible!==!1?s.jsx(U,{}):s.jsx(B,{})}),s.jsx("button",{className:"btn-icon",title:"Edit Product",onClick:()=>E(e),children:s.jsx(G,{})}),s.jsx("button",{className:"btn-icon",title:"View Details",onClick:()=>D(e),children:s.jsx(h,{})}),s.jsx("button",{className:"btn-icon danger",title:"Delete Product",onClick:()=>F(e),children:s.jsx(q,{})})]})]})]},e.id))})]})}):s.jsx(g,{title:"Manage Products",subtitle:"View and manage all your products",children:s.jsxs("div",{className:"no-shop-message",children:[s.jsx(h,{className:"coming-soon-icon"}),s.jsx("h2",{children:"No Shop Found"}),s.jsx("p",{children:"You need to create a shop first before managing products."}),s.jsx("button",{className:"btn btn-primary",onClick:()=>window.location.href="/shop",children:"Create Shop"})]})})}export{K as default};
